<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Products</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <header class="container mt-5">
    <h1 class="mb-4">All Products</h1>

    <div class="d-flex justify-content-between mb-3">
      <p>Products Showing: {{ start }} - {{ end }}</p>
      <p>Total Products: {{ total_count }}</p>
    </div>

    <div class="d-flex justify-content-between mb-3">
      <!-- Filters -->
      <form method="get" class="mb-3 d-flex gap-3 align-items-center">
          <label class="" for="limit">
            Show:
          </label>
          <select id="limit" name="limit" class="form-select" style="width: 100px;" onchange="this.form.submit()">
              <option value="5" {% if limit == 5 %}selected{% endif %}>5</option>
              <option value="20" {% if limit == 20 %}selected{% endif %}>20</option>
              <option value="40" {% if limit == 40 %}selected{% endif %}>40</option>
              <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
              <option value="70" {% if limit == 70 %}selected{% endif %}>70</option>
              <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
          </select>
      </form>
      
      <div>
        <button type="button" id="perform_all" class="btn btn-outline-success">Perform to all</button>
      </div>
    </div>
  </header>

  <main class="container mt-5">
    {% for product in products %}
      <div class="card mb-3" style="">
        <div class="row g-0">
          <div class="col-md-2 p-2">
            <img src="{{ product.image_url }}" class="img-fluid rounded-start" alt="{{ product.title }}">
          </div>
          <div class="col-md-10">
            <div class="card-body">
              <a href="{{ product.url }}/?preview_theme_id=141170180290" target="_blank">
                <h5 class="card-title">{{ product.title }}</h5>
              </a>
              <p>Product ID: {{ product.id }}</p>
              <p>Variant Count: {{ product.variantsCount }}</p>
              <p>Product level Image Count: {{ product.imagesCount }}</p>
              <p>All Variant level Image Count: {{ product.all_variant_level_image_count }}</p>
              {% if product.filled_images %}
                <button disabled class="btn mb-3 btn-outline-primary" data-product-id="{{ product.id }}">âœ… Done</button>
              {% else %}
                <button class="btn mb-3 btn-outline-primary" data-product-id="{{ product.id }}">Populate Images</button>
              {% endif %}
              <div class="result"></div>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}

    <!-- Pagination Controls -->
    <nav aria-label="Product pagination">
      <ul class="pagination justify-content-center">

        {% if has_previous_page and start_cursor %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('all_product', limit=limit, before=start_cursor, start=start-limit) }}">Previous Page</a>
          </li>
        {% endif %}
        {% if has_next_page and end_cursor %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('all_product', limit=limit, after=end_cursor, start=end+1) }}">Next Page</a>
          </li>
        {% endif %}
        
      </ul>
    </nav>

  </main>

  <footer class="py-3 my-4">
    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
    </ul>
    <p class="text-center text-body-secondary">Create by 
      <a class="" href="www.linkedin.com/in/md-abdullah-9121b5228">
        Osama Abdullah
      </a>
    </p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='custom.js') }}"></script>
</body>
</html>